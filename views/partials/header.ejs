<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <% 
        const siteTitle = typeof title !== 'undefined' && title ? `${title} | CottageIndustries` : 'CottageIndustries';
        const siteDescription = typeof description !== 'undefined' && description ? description : 'A showcase of personal projects, experiments, and thoughts on technology. Exploring the intersection of code, design, and creativity.';
        
        let siteImage = typeof image !== 'undefined' && image ? image : '';
        const siteUrl = typeof currentUrl !== 'undefined' ? currentUrl : '';
        const siteType = typeof type !== 'undefined' ? type : 'website';

        if (siteImage && siteImage.startsWith('/') && siteUrl) {
             try {
                const urlObj = new URL(siteUrl);
                siteImage = `${urlObj.protocol}//${urlObj.host}${siteImage}`;
             } catch (e) {
                // Invalid URL, keep relative or ignore
             }
        }
    %>

    <title><%= siteTitle %></title>
    <meta name="description" content="<%= siteDescription %>">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="<%= siteType %>">
    <meta property="og:url" content="<%= siteUrl %>">
    <meta property="og:title" content="<%= siteTitle %>">
    <meta property="og:description" content="<%= siteDescription %>">
    <% if (siteImage) { %>
    <meta property="og:image" content="<%= siteImage %>">
    <% } %>

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="<%= siteUrl %>">
    <meta property="twitter:title" content="<%= siteTitle %>">
    <meta property="twitter:description" content="<%= siteDescription %>">
    <% if (siteImage) { %>
    <meta property="twitter:image" content="<%= siteImage %>">
    <% } %>

    <link href="/css/output.css" rel="stylesheet">
    <link href="/css/prism.css" rel="stylesheet">
    <link href="/css/prism-toolbar.css" rel="stylesheet">
    <link href="/css/prism-copy-to-clipboard.css" rel="stylesheet">
</head>
<body class="bg-zinc-950 text-zinc-300 font-sans antialiased min-h-screen flex flex-col">
    <%- include('tos_modal') %>
    <nav class="border-b border-zinc-800 bg-zinc-900/50 backdrop-blur-md sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-6 h-16 flex items-center justify-between">
            <a href="/" class="text-xl font-bold text-zinc-100 tracking-tighter hover:text-orange-500 transition-colors">
                Cottage<span class="text-orange-500">Industries</span>
            </a>
            <div class="flex gap-6 text-sm font-medium">
                <a href="/" class="hover:text-white transition-colors">Home</a>
                <a href="/#projects" class="hover:text-white transition-colors">Projects</a>
                <a href="/#blog" class="hover:text-white transition-colors">Blog</a>
                <% if (typeof user !== 'undefined' && user) { %>
                    <% if (typeof isAdmin !== 'undefined' && isAdmin) { %>
                        <a href="/admin" class="text-orange-500 hover:text-orange-400">Admin</a>
                    <% } %>
                    <a href="/account" class="hover:text-white">Account</a>
                    <a href="/logout" class="hover:text-white">Logout</a>
                <% } else { %>
                    <a href="/login" class="hover:text-white">Login</a>
                <% } %>
            </div>
        </div>
    </nav>
    <main class="grow">
